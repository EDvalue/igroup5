<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="../CSS/studentInClassInfo.css" rel="stylesheet" />

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <!-- DataTables -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://unpkg.com/ionicons@5.0.0/dist/ionicons.js"></script>


    <script>
        var studentGraphData;
        var studentsArr = [];
        var userOBJ;
        var xLabels = [];
        var yLabels = [];
        var xLableCharts = new Array();
        var yLableBibleChart = new Array();
        var yLableScienceChart = new Array();
        var yLableHistoryChart = new Array();
        var options = {
            responsive: true,
            maintainAspectRatio: true,
            legend: {

            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            },
            legend: {
                labels: {
                    // This more specific font property overrides the global property
                    fontColor: 'black',
                    fontSize: 20
                },
            },
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        fontColor: 'black',
                        fontSize: 25
                    },
                }],
                xAxes: [{
                    ticks: {
                        fontColor: 'black',
                        fontSize: 25
                    },
                }]
            },

        };
        var myChart;
        var task;
        var bibleChart;
        var historyChart;
        var scienceChart;
        var performer;
        var activeTteam;
        var taskData
        var selectedTaskId
        var myTeams;

        $(document).ready(function () {
            if (localStorage["user"])
                userOBJ = JSON.parse(localStorage["user"])
            if (localStorage["performer"])
                performer = localStorage["performer"];
            if (localStorage["active_teacher_team"])
                activeTteam = JSON.parse(localStorage["active_teacher_team"]);
            if (localStorage["studentData"])
                studentGraphData = localStorage["studentData"];
            //ajaxCall("GET", "../api/StudentInClass", "", getSuccess, getError);

            bringStTasks();

            createTDDL();

            UpdateTaskDoughnut();

             $("#assigmentForm").hide();

        });
        //----------------------בחירת משימה לפי הת.ז של המשימה
         function getTakById(id) {
            for (x in taskList) {
                if (taskList[x].taskId == id) {
                    return taskList[x];
                }
            }
        }

        //-----------------Opening a Questionnaire----------------------------

        function getPdata(id) {

            for (x in taskData) {
                if (taskData[x].QuizID == id) {
                    return taskData[x];
                }
            }

        }
        function openQ(val) {

            chosenSt = getPdata(val.getAttribute('data_loc'));

            Oquiz = {
                QuizID: chosenSt.QuizID,
                Mail: chosenSt.Mail,
                TaskId: chosenSt.TaskId,
                TeamId: activeTteam.Id,
            }

            ajaxCall("PUT", "../api/Teacher/getQ", JSON.stringify(Oquiz), getQsuccess, getQerror)
        }



        function getQsuccess(data) {

            localStorage["performers"] = JSON.stringify(taskData);
            localStorage["userMode"] = "teacher";
            localStorage["quiz_mode"] = "check";
            localStorage["performer"] = chosenSt.TaskId;
            localStorage["quiz"] = JSON.stringify(data);

            location.assign("showQuiz.html");
        }

        function getQerror(err) {

            swal("הניסיון לפתוח את המשימה נכשל")
        }


        //-----------------יצירת רשימת הכיתות שלי----------------------------
        function createTDDL() {
            myTeams = JSON.parse(localStorage["myTeams"]);
            var cstr = "<option>בחר כיתה</option>";
            for (a in myTeams) {

                cstr += "<option id=plink  value=" + myTeams[a].Id + "><a  href='manageClass.html'>" + myTeams[a].Title + "</a></option>"


            }
            console.log(cstr)
            $("#TeamDDL").html(cstr);

        }
        function openTeam() {


            tId = $("#TeamDDL").val();
            console.log(tId)
            for (team in myTeams) {
                if (myTeams[team].Id == tId) {
                    localStorage["active_teacher_team"] = JSON.stringify(myTeams[team]);
                    localStorage['quizSubject'] = myTeams[team].Subject.Name;

                    location.assign("manageClass.html");


                }
            }
        }

        //-----------------יצירת דאטה טייבל----------------------------
        function bringStTasks() {

            info = {
                Mail: performer,
                TeamId: activeTteam.Id,
            }

            ajaxCall("PUT", "../api/Teacher/getStTasksInTeam", JSON.stringify(info), getStTasksInTeamSuccess, getStTasksInTeamError)
        }

        function getStTasksInTeamSuccess(data) {
            console.log(data);
            taskData = data;

            try {
                tbl = $('#sp_table').DataTable({

                    data: taskData,
                    pageLength: 5,
                    columns: [



                        { data: "title" },
                        {
                            render: function (data, type, row, meta) {

                                let loc = "data_loc='" + row.QuizID + "'";
                                str = "";
                                str += "<div id='tbl_int'>";
                                if (row.QuizID != "") {
                                    str += `<img ${loc} onclick='openQ(this)'  src='../images/${row.IntelligenceName}.png'/>`
                                } else {

                                    return "לא נבחר שאלון"
                                }

                                str += "</div>";

                                return str;
                            }

                        },
                        {
                            render: function (data, type, row, meta) {

                                if (row.Grade > 0) {
                                    return row.Grade
                                } else {
                                    return "לא ניתן ציון"
                                }

                            }
                        },
                        {
                            render: function (data, type, row, meta) {

                                if (row.Note != "") {
                                    if (row.Note.length > 15) {
                                        return `<p  title="${row.Note}">${row.Note.substr(0, 15)}...</p>`
                                    } else {
                                        return `<p  title="${row.Note}">${row.Note}</p>`
                                    }

                                } else {
                                    return "none"
                                }

                            }
                        },
                        {
                            render: function (data, type, row, meta) {

                                if (row.Ptime != "") {
                                    return `<span>${row.Ptime} <ion-icon id="cptime" name="pencil-outline"></ion-icon></span>`

                                } else {
                                    return "לא ניתן זמן הגשה"
                                }

                            }
                        },


                    ],
                });

            }
     

            catch (err) {
                alert(err);
            }

        }
                 $("#cptime").click(function () {
                $("#assigmentForm").slideToggle('2s');
                selectedTsakId = this.parentNode.parentNode.parentNode.id;
                t = getTakById(selectedTsakId);
                $("#ptime").val(t.Ptime);
               
            });

        function getStTasksInTeamError(err) {
            console.log(err);
        }

        function getSuccess(data) {
            studentsArr = data;
            console.log(studentsArr);

            for (var i = 0; i < studentsArr.length; i++) {
                if (studentsArr[i].SubjectName == "Bible") {
                    yLableBibleChart.push(studentsArr[i].Grade);
                    xLableCharts.push(studentsArr[i].IntelligenceName)
                }

                else if (studentsArr[i].SubjectName == "Science")
                    yLableScienceChart.push(studentsArr[i].Grade);
                else if (studentsArr[i].SubjectName == "History")
                    yLableHistoryChart.push(studentsArr[i].Grade);

            }
            console.log("this is bible chart : ");
            console.log(yLableBibleChart);
            console.log("this is science chart : ");
            console.log(yLableScienceChart);
            console.log("this is history chart : ");
            console.log(yLableHistoryChart);
            console.log("this is x for charts: ");
            console.log(xLableCharts);

        }
        function getError(err) {
            console.log(err);

        }
        function getByEmailSuccess(data) {

            console.log(data);

        }
        function getByEmailError(err) {
            console.log(err);

        }
        function ChartIt() {
            //myChart.destroy();

            var ctx = document.getElementById('myChart').getContext('2d');

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: xLableCharts,
                    datasets: [
                        {
                            label: 'Bible',
                            data: yLableBibleChart,
                            backgroundColor: 'rgba(255, 99, 132, 1)',
                            borderColor: 'rgba(255, 99, 132, 2)',
                            borderWidth: 1
                        },
                        {
                            label: 'Science',
                            data: yLableScienceChart,
                            backgroundColor: 'rgba(255, 150, 132, 1)',
                            borderColor: 'rgba(255, 150, 132, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'History',
                            data: yLableHistoryChart,
                            backgroundColor: 'rgba(255, 13, 22, 1)',
                            borderColor: 'rgba(255, 13, 22, 1)',
                            borderWidth: 1
                        },

                    ]
                },
                options: options
            });
        }
        function updateBible() {

            //  b = document.getElementById('BibleChart');
            //   toggle_visibility(b);
            var ctx = document.getElementById('BibleChart').getContext('2d');

            bibleChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: xLableCharts,
                    datasets: [
                        {
                            label: 'Bible',
                            data: yLableBibleChart,
                            backgroundColor: 'rgba(255, 99, 132, 1)',
                            borderColor: 'rgba(255, 99, 132, 2)',
                            borderWidth: 1
                        },
                    ]
                },
                options: options
            });
        }

        function updateScience() {

            // s = document.getElementById('ScienceChart');
            //toggle_visibility(s);
            var ctx = document.getElementById('ScienceChart').getContext('2d');

            scienceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: xLableCharts,
                    datasets: [
                        {
                            label: 'Science',
                            data: yLableScienceChart,
                            backgroundColor: 'rgba(255, 150, 132, 1)',
                            borderColor: 'rgba(255, 150, 132, 1)',
                            borderWidth: 1
                        },
                    ]
                },
                options: options
            });
        }

        function updateHistory() {

            // h = document.getElementById('HistoryChart');
            // toggle_visibility(h);
            var ctx = document.getElementById('HistoryChart').getContext('2d');

            historyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: xLableCharts,
                    datasets: [
                        {
                            label: 'History',
                            data: yLableHistoryChart,
                            backgroundColor: 'rgba(255, 13, 22, 1)',
                            borderColor: 'rgba(255, 13, 22, 1)',
                            borderWidth: 1
                        },
                    ]
                },
                options: options
            });

        }
        function UpdateTaskDoughnut() {
            var ctx2 = document.getElementById('TasksDoughnut').getContext('2d');

            task = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['הוגש', 'לא הוגש'],
                    datasets: [
                        {

                            data: [2, 3],
                            backgroundColor: ['rgba(152,251,152)', 'rgba(135,206,250)'],

                        },

                    ]
                },
                options: {
                    responsive: true,
                    legend: {
                        position: 'top',
                        labels: {
                            // This more specific font property overrides the global property
                            fontColor: 'black',
                            fontSize: 15
                        },
                    },

                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }
        function ChartChange() {
            var x = document.getElementById("mySelect").value;
            //  var statDiv = document.getElementById("statistics");
            var FirstCharts = document.getElementById("FirstCharts");
            var SecondCharts = document.getElementById("SecondCharts");
            var ThirdCharts = document.getElementById("ThirdCharts");
            var FourthCharts = document.getElementById("FourthCharts");
            if (x == "FirstCharts") {
                //   statDiv.style.display = "block";
                FirstCharts.style.display = "block";
                SecondCharts.style.display = "none";
                // ThirdCharts.style.display = "none";
                //FourthCharts.style.display = "none";
                ChartIt();
            }
            else if (x == "SecondCharts") {
                //    statDiv.style.display = "block";
                FirstCharts.style.display = "none";
                SecondCharts.style.display = "block";
                //ThirdCharts.style.display = "none";
                //FourthCharts.style.display = "none";
                updateBible();
                updateScience();
                updateHistory();
            }
            else {
                // statDiv.style.display = "none";
                FirstCharts.style.display = "none";
                SecondCharts.style.display = "none";
            }
            /* else if (x == "ThirdCharts") {
                 FirstCharts.style.display = "none";
                 SecondCharts.style.display = "none";
                 ThirdCharts.style.display = "block";
                 FourthCharts.style.display = "none";
                 updateScience();
             }
             else if (x == "FourthCharts") {
                 FirstCharts.style.display = "none";
                 SecondCharts.style.display = "none";
                 ThirdCharts.style.display = "none";
                 FourthCharts.style.display = "block";
                 updateHistory();
             }
             else {
                 FirstCharts.style.display = "none";
                 SecondCharts.style.display = "none";
                 ThirdCharts.style.display = "none";
                 FourthCharts.style.display = "none";
             }*/

        }
        function func1() {

            //  var statDiv = document.getElementById("statistics");
            var FirstCharts = document.getElementById("FirstCharts");
            var SecondCharts = document.getElementById("SecondCharts");

            FirstCharts.style.display = "block";
            SecondCharts.style.display = "none";
        }
        function func2() {

            //  var statDiv = document.getElementById("statistics");
            var FirstCharts = document.getElementById("FirstCharts");
            var SecondCharts = document.getElementById("SecondCharts");

            FirstCharts.style.display = "none";
            SecondCharts.style.display = "block";
        }
        function func3() {

            //  var statDiv = document.getElementById("statistics");
            var FirstCharts = document.getElementById("FirstCharts");
            var SecondCharts = document.getElementById("SecondCharts");

            FirstCharts.style.display = "none";
            SecondCharts.style.display = "none";
        }
    </script>
</head>
<body dir="rtl">
    <div id="assigment">
        <form id="assigmentForm">
            <a onclick="closeDivAU()"><span>Close x</span></a>

            <div id="submition_date">
                <span>תאריך הגשה אחרון לתלמיד:</span>
                <input type="datetime-local" step="1" id="pTime" />

            </div>
            <div id="assignmentFormBtn">
                <input type="submit" class="btn btn-info" value="שלח" />
            </div>

        </form>
    </div>
    <div id="container">
        <div id="header" class="row">

            <div id="imgLogo" class="col-lg-3">

                <img src="../images/EDvalueSmall.png" />

            </div>

            <div id="title" class="col-lg-6">
                <h3> שלום מורה</h3>

            </div>

            <div id="mindcetImg" class="col-lg-3 d-none d-lg-block">

                <!--<img src="../images/MindCet.png" />-->

            </div>

        </div>


        <nav class="navbar navbar-expand-lg navbar-light navBar">

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav navPadding">

                    <li class="nav-item">
                        <select class="btn btn-primary btnonSmall" id="TeamDDL" onchange="openTeam()">

                            הכיתות שלי
                        </select>
                    </li>
                    <li class="nav-item dropdown">

                        <select class="btn btn-primary btnonSmall" id="mySelect" onchange="ChartChange()">
                            <option value="" disabled selected hidden>בחר גרף</option>
                            <option value="FirstCharts">כולם ביחד</option>
                            <option value="SecondCharts">כולם לחוד</option>
                            <option value="CloseAll">לסגור הכל</option>
                        </select>
                    </li>

                </ul>
                <form class="form-inline my-2 my-lg-0 mr-auto">
                    <input class="myForm mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-primary my-2 my-sm-0" type="submit">Search</button>
                </form>
            </div>
        </nav>


        <!-- <div id="Tcontroll">
            <div id="TControlBtns">
                <button id="newClassBTN" class="btn btn-primary " onclick="CnewTeam()">צור קבוצה חדשה</button>

                <button type="button" class="btn btn-primary  dropdown-toggle" data-toggle="dropdown">
                    הכיתות שלי
                </button>
                <select class="btn btn-primary" id="mySelect" onchange="ChartChange()">
                    <option value="" disabled selected hidden>בחר גרף</option>
                    <option value="FirstCharts">כולם ביחד</option>
                    <option value="SecondCharts">כולם לחוד</option>
                    <option value="CloseAll">לסגור הכל</option>
                </select>
                <div id="nav_cnt" class="dropdown-menu">


                </div>
            </div>

            <div class="searchDiv">
                <div class="d-flex justify-content-center ">
                    <div class="searchbar">
                        <input class="search_input" type="text" name="" placeholder="חיפוש תלמיד">
                        <a href="#" class="search_icon"><i class="fas fa-search"></i></a>
                    </div>
                </div>
            </div>

        </div>-->

        <div id="statistics">
            <div class="row" id="FirstCharts" style="display:none">

                <div class="col-12 col-lg-12" id="mixedChart">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
            <div class="row" id="SecondCharts" style="display:none">
                <div class="col-12 col-lg-4 canvasDiv">
                    <canvas id="BibleChart"></canvas>
                </div>
                <div class="col-12 col-lg-4 canvasDiv">
                    <canvas id="HistoryChart"></canvas>
                </div>
                <div class="col-12 col-lg-4 canvasDiv">
                    <canvas id="ScienceChart"></canvas>
                </div>
            </div>

        </div>




        <div id="TaskView">

            <div id="addContent">

                <table id="sp_table" class="display nowrap" style="width:100%">
                    <thead>
                        <tr>

                            <th>משימה</th>
                            <th>שאלון</th>
                            <th>ציון</th>
                            <th>הערה</th>
                            <th>זמן הגשה אחרון</th>
                        </tr>
                    </thead>
                </table>

            </div>
        </div>
    </div>
    <!--</div>-->

</body>
</html>