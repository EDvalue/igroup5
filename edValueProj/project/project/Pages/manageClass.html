<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Varela Round' rel='stylesheet'>
    <meta charset="utf-8" />
    <title></title>
    <link href="../CSS/newQuiz.css" rel="stylesheet" />
    <link href="../CSS/manageClass.css" rel="stylesheet" />
    <link href="../CSS/teacherDashbord.css" rel="stylesheet" />
    <link href="../CSS/scrollbar.css" rel="stylesheet" />
    <link rel="shortcut icon icon" type="image/png" href="../images/favicon.png" />
    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="../js/js.js"></script>
    <script src="../js/Graphs.js"></script>

    <script type="text/javascript" charset="utf-8" src="https://rawgit.com/hebcal/hebcal-js/master/client/hebcal.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <script src="https://unpkg.com/ionicons@5.0.0/dist/ionicons.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@0.5.7/chartjs-plugin-annotation.min.js"></script>

    <script>
        document.title = "ניהול קבוצה";
        var myTeams;
        var userOBJ;
        var listdata;
        var chosenSt;
        var taskList, sortedTaskList = [];
        var selectedTsakId;
        var taskData;
        var activeTteam;
        var numwaiting
        var tbl;//data table
        var graphData;
        var graphObject = {
            taskArr: [],
            intelligenceArr: [],
            //studentArr:[]
        };
        var sortTags = {
            taskArr: [],
            intelligenceArr: [],
            // studentArr:[]
        };
        var sortedGraphData;
        var intGraphData, intSortedGraphData;
        var myClasses;

        $(document).ready(function () {
            if (localStorage["myClasses"])
                myClasses = JSON.parse(localStorage["myClasses"])
            if (localStorage["active_teacher_team"])
                activeTteam = JSON.parse(localStorage["active_teacher_team"]);
            if (localStorage["user"]) {
                userOBJ = JSON.parse(localStorage["user"]);
                $("#user_manage>button").append(userOBJ.Name + " " + userOBJ.LastName);
            }

            getClasses();
            $("#years>select").change(function () {

                sortedTaskList = []
                val = $(this).children("option:selected").val();
                for (x in taskList) {
                    if (taskList[x].YearOfStudy.replace("``", "") == val) {
                        sortedTaskList.push(taskList[x]);
                    }
                }
                printSortedTaskList();
                $(".cancel .icon-inner title").html("בטל שיוך.")

            });

            createSList();
            createTList();
            className();
            getTasks();
            $("#ShowQuestionnaire").hide();
            $("#assigmentForm").hide();


            ajaxCall("GET", '../api/Teacher/getGraphTeamData/' + activeTteam.Id, "", getGraphTeamDataSuccess, getGraphTeamDataError)

            $("#assigmentForm").submit(function () {
                submitTaskAssigment()
                return false;
            });
            $('#mySelect').change().val('GradeCharts').trigger('change');



            $("#toggleTask").click(function () {
                $("#taskName").slideToggle('2s');
            });
            $(".capr").click(function () {

                if ($('#IntelligenceCheckBox').is(':visible')) {
                    $('#IntelligenceCheckBox').toggle('drop');
                    $("div#stat_control_top").css("width", "5%");
                    $(".capr").css("border-radius", "50%");

                }
                else {
                    $('#IntelligenceCheckBox').toggle();
                    $("div#stat_control_top").css('width', '90%');
                    $(".capr").css("border-radius", "0%");
                    $(".capr").css("border-top-right-radius", "50%");
                    $(".capr").css("border-bottom-right-radius", "50%");


                }

            });


            $('.scroll-down').click(function () {
                $('html, body').animate({ scrollTop: $('#tasks').offset().top }, 'slow');
                return false;
            });

        });

        function submitTaskAssigment() {

            var currentDate = new Date();
            var ClassDate = new Date($('#classDate').val());
            var SubmitionDate = new Date($('#submitionDate').val());

            classTime = $("#class_date>input[type='datetime-local']").val().split("T")[1].split(":").length != 3 ?
                $("#class_date>input[type='datetime-local']").val() + ":00" : $("#class_date>input[type='datetime-local']").val();

            subTime = $("#submition_date>input[type='datetime-local']").val().split("T")[1].split(":").length != 3 ?
                $("#submition_date>input[type='datetime-local']").val() + ":00" : $("#submition_date>input[type='datetime-local']").val()
            assignment = {
                classTime: classTime,
                submitionTime: subTime,
                TaskId: selectedTsakId,
                TeamId: activeTteam.Id,
                TeamSchoolCode: userOBJ.SCode,

            }


            if (ClassDate > SubmitionDate)
                swal("התאריך הראשון מאוחר מהשני");
            //else if (ClassDate < currentDate)
            //    swal("התאריך של השיעור מוקדם מהתאריך של היום הנוכחי");
            else {

                ajaxCall('PUT', '../api/Teacher/updateAssigment', JSON.stringify(assignment), updateAssigmentSuccess, updateAssigmentError)


            }

        }

        function updateAssigmentSuccess(data) {
            swal({

                title: "תאריך המשימה עודכן",
                icon: "success",
            })
            console.log(data);

            t = getTakById(selectedTsakId);
            t.ForDate = $("#class_date>input[type='datetime-local']").val();
            t.OpenTill = $("#submition_date>input[type='datetime-local']").val()
            printSortedTaskList();


            closeDivAU();
        }
        function printSortedTaskList() {
            var str = "";
            for (t in sortedTaskList) {
                str += createTaskDiv(sortedTaskList[t]);
            }
            $("#tasks").html(str);
            connectTaskList();
            $(".cancel .icon-inner title").html("בטל שיוך.")
        }

        function updateAssigmentError(err) {
            console.log(err);
        }

        function closeDivAU() {
            $("#assigmentForm").slideToggle('2s');

        }

        function checkTTime() {
            var d = Date.now();


            for (a in taskList) {
                if (taskList[a].ForDate < d.toString() && taskList[a].OpenTill > d.toString()) {
                    $("ion-icon").css("color", "green");
                    console.log("green")
                }

                else if (taskList[a].OpenTill < d.toString()) {
                    $("ion-icon").css("color", "red");
                    console.log("red")
                }



            }

        }
        function getClasses() {

            for (c in myClasses) {

                if (myClasses[c].Grade != 10) {

                    str = `<option value="${c}">${myClasses[c].Name}</option>`
                    $("#nav_classes").append(str);

                } else {

                    str = `<option class='PastC' value="${c}">${myClasses[c].Name}</option>`
                    $("#nav_classes").append(str);

                }
            }
        }

        function openClass() {
            x = $("#nav_classes").children("option:selected")
            myclass = myClasses[$(x).attr("value")];
            localStorage["Teacher_inClass"] = JSON.stringify(myclass);
            location.assign("myClass.html");

        }

        function getGraphTeamDataSuccess(data) {
            console.log(data);
            graphData = data;
            sortedGraphData = data;

            ajaxCall("GET", "../api/Teacher/intTeamGraph/" + activeTteam.Id, "", intTeamGraphSuccess, intTeamGraphError)

        }

        function getGraphTeamDataError(err) {
            console.log(err);
        }

        function intTeamGraphError(err) {

        }

        function intTeamGraphSuccess(data) {
            console.log(data);

            sortDivs();
            UpdateTaskDoughnut();
            GradesAvgChart()
            PercentageChart();
            intGraphData = data;
            intSortedGraphData = data;
            ChartIntl();
        }



        function sortDivs() {
            var obj = {};
            var taskName = {};
            // var studentName = {};
            //var fullName = "";
            var flag = 0;
            for (x in graphData) {

                if (graphData[x].isperform == 1) {
                    if (!obj[graphData[x].IntelligenceName])
                        graphObject.intelligenceArr.push(graphData[x].IntelligenceName);
                    obj[graphData[x].IntelligenceName] = graphData[x].IntelligenceName;
                }
                else {
                    graphData[x].IntelligenceName = "לא ביצעו"
                    obj["לא ביצעו"] = "לא ביצעו"
                    if (!flag)
                        graphObject.intelligenceArr.push("לא ביצעו");
                    flag = 1;
                }
                if (!taskName[graphData[x].TaskTitle]) {
                    taskName[graphData[x].TaskTitle] = graphData[x].TaskTitle;
                    graphObject.taskArr.push(graphData[x].TaskTitle)
                }
                //fullName = graphData[x].Fname + " " + graphData[x].Lname;
                //graphObject.studentArr.push(fullName);
                //studentName[x] = fullName;


            }
            //console.log(graphObject.studentArr)
            //console.log(obj)
            printIntelligence(obj);
            printTaskName(taskName);
            //printStudentForGraph(studentName);
        }
        function sortGraphData(arrName, val) {

            $("#info input[type='checkbox']").attr('disabled', 'disabled')
            setTimeout(function () { $("#info input[type=checkbox]").attr('disabled', false); }, 1100);
            sortedGraphData = [];
            var valID = val.parentNode.id;
            var isChecked = $(val).prop("checked");

            if (isChecked) {
                sortTags[arrName].push(valID)
            }
            else {
                if (sortTags[arrName].indexOf(valID) != -1) {
                    var index = sortTags[arrName].indexOf(valID);
                    sortTags[arrName].splice(index, 1)
                }

            }
            var arr = $("#main input:checked")
            if (arr.length > 0) {
                for (x in graphData) {

                    if ((sortTags["intelligenceArr"].indexOf(graphData[x].IntelligenceName) != -1 || sortTags["taskArr"].indexOf(graphData[x].TaskTitle.replace(`"`, "")) != -1)) {

                        sortedGraphData.push(graphData[x])
                    }


                }
                console.log(sortedGraphData)
                task.data.datasets = sortedGraphData
                gradesAvgChart.data.datasets = sortedGraphData
                IntPercentageChart.data.datasets = sortedGraphData
                UpdateTaskDoughnut()
                GradesAvgChart()
                PercentageChart()
            } else {
                sortedGraphData = graphData;
                console.log(sortedGraphData);
                console.log(sortedGraphData);
                task.data.datasets = sortedGraphData
                gradesAvgChart.data.datasets = sortedGraphData
                IntPercentageChart.data.datasets = sortedGraphData
                UpdateTaskDoughnut()
                GradesAvgChart()
                PercentageChart()

            }

        }
        function printIntelligence(obj) {
            var str = "";
            for (x in obj) {
                str += `<div id="${x}"><input type="checkbox" onchange="sortGraphData('intelligenceArr',this)" /><span>${intDictionary[x]}</span></div>`
            }
            $("#IntelligenceCheckBox").append(str);
        }
        function printTaskName(obj) {
            var str = "";
            for (x in obj) {
                str += `<div id="${x.replace(`"`, "")}"><input type="checkbox" onchange="sortGraphData('taskArr',this)" /><span>${x}</span></div>`
            }
            $("#taskName").append(str)
        }
        function printStudentForGraph(obj) {
            str = "";
            for (x in obj) {
                str += `<div id="${x}"><input type="checkbox" onchange="sortGraphData('studentArr',this)"/><span>${obj[x]}</span></div>`
            }
            $("#filterStudent").append(str);
        }
        function getPdata(id) {

            for (x in taskData) {
                if (taskData[x].Mail == id) {
                    return taskData[x];
                }
            }

        }


        function openQ(val) {

            chosenSt = getPdata(val.getAttribute('data_loc'));

            Oquiz = {
                QuizID: chosenSt.QuizID,
                Mail: chosenSt.Mail,
                TaskId: selectedTaskId,
                TeamId: activeTteam.Id,
            }

            ajaxCall("PUT", "../api/Teacher/getQ", JSON.stringify(Oquiz), getQsuccess, getQerror)
        }

        function getQsuccess(data) {
            localStorage["performers"] = JSON.stringify(taskData);
            localStorage["userMode"] = "teacher";
            localStorage["quiz_mode"] = "check";
            localStorage["performer"] = chosenSt.Mail;
            localStorage["quiz"] = JSON.stringify(data);

            location.assign("showQuiz.html");
        }

        function getQerror(err) {

            swal("הניסיון לפתוח את המשימה נכשל")
        }

        function createSList() {
            listdata = JSON.parse(localStorage["active_teacher_team"]);
            listdata1 = listdata.StudentList;
            console.log(listdata1)
            var cstr = "<ul>"
            for (a in listdata1) {
                cstr += "<li st='" + listdata1[a].Mail + "'>" + listdata1[a].Name + " " + listdata1[a].LastName + "</li>"

            }

            cstr += "</ul>"
            console.log(cstr)
            $("#sList").html(cstr);
            $("#sList li").click(openSt)
        }

        function openSt() {
            var studentArr = [];
            var intPointsArr = [];
            for (x in graphData) {
                if (graphData[x].Mail == this.getAttribute('st')) {
                    studentArr.push(graphData[x])
                }
            }
            for (x in intGraphData) {
                if (intGraphData[x].Mail == this.getAttribute('st')) {
                    intPointsArr.push(intGraphData[x])
                    localStorage["intStudentData"] = JSON.stringify(intPointsArr);
                    break;
                }
            }
            localStorage["studentData"] = JSON.stringify(studentArr);
            localStorage["performer"] = this.getAttribute('st');
            location.assign("studentInClassInfo.html");

        }

        function ShowSubmitted(val) {

            $("#utDIV").html = `<p>${val}</p>`;

            data = val + "," + listdata.Id;
            selectedTaskId = val;

            ajaxCall("GET", "../api/StudentInClass/getSQuest/" + data, "", getSQuestSuccess, getSQuestError)

        }
        function getSQuestSuccess(data) {
            console.log(data)
            taskData = data;

            try {
                tbl = $('#sp_table').DataTable({

                    data: taskData,
                    pageLength: 5,
                    columns: [

                        { data: "Mail" },
                        {
                            render: function (data, type, row, meta) {

                                if (row.isWaiting == 0)
                                    return `<input type='checkbox' disabled   style='zoom:2'/>`;
                                else
                                    return `<input type='checkbox' disabled checked style='zoom:2'/>`;
                            }
                        },
                        { data: "IdNumber" },
                        { render: function (data, type, row, meta) { return `${row.Fname} ${row.Lname}` } },

                        {
                            render: function (data, type, row, meta) {

                                let loc = "data_loc='" + row.Mail + "'";
                                str = "";
                                str += "<div id='tbl_int'>";
                                if (row.QuizID != "") {
                                    str += `<img ${loc} onclick='openQ(this)'  src='../images/${row.IntelligenceName}.png'/>`
                                } else {

                                    return "לא נבחר שאלון"
                                }

                                str += "</div>";

                                return str;
                            }

                        },
                        {
                            render: function (data, type, row, meta) {

                                if (row.Grade > 0) {
                                    return row.Grade
                                } else {
                                    return "לא ניתן ציון"
                                }

                            }
                        },
                        {
                            render: function (data, type, row, meta) {

                                if (row.Note != "") {
                                    if (row.Note.length > 15) {
                                        return `<p  title="${row.Note}">${row.Note.substr(0, 15)}...</p>`
                                    } else {
                                        return `<p  title="${row.Note}">${row.Note}</p>`
                                    }

                                } else {
                                    return "none"
                                }

                            }
                        },


                    ],
                });

            }

            catch (err) {
                alert(err);
            }

            $("#ShowQuestionnaire").show();

        }

        function getSQuestError(data) {
            console.log(data)
        }



        function closeDivUS() {

            $("#ShowQuestionnaire").hide();
            tbl.destroy();


        }

        function createTList() {
            myTeams = JSON.parse(localStorage["myTeams"]);
            console.log(myTeams)
            var cstr = "";
            for (a in myTeams) {

                if (myTeams[a].Title != listdata.Title) {

                    if (myTeams[a].Grade != 10)
                        cstr += `<option value="${myTeams[a].Id}" >${myTeams[a].Title}</option>`;
                    else {
                        cstr += `<option class='PastC' value="${myTeams[a].Id}" >${myTeams[a].Title}</option>`
                    }
                }
            }
            $("#teamSelect").append(cstr);



            console.log(cstr)
            $("#tList").html(cstr);
        }

        function className() {

            title = listdata.Title;
            $("#title>h3").html(title);
        }
        function openTeam() {

            tId = $("#teamSelect").children("option:selected").attr("value");

            for (team in myTeams) {
                if (myTeams[team].Id == tId) {
                    localStorage["active_teacher_team"] = JSON.stringify(myTeams[team]);
                    localStorage['quizSubject'] = myTeams[team].Subject.Name;

                    location.assign("manageClass.html");
                }
            }
        }
        function getTasks() {
            var getTeam;
            getTeam = JSON.parse(localStorage["active_teacher_team"]);

            console.log(getTeam)
            ajaxCall("GET", "../api/Teacher/getTTasks/" + getTeam.Id, "", getTTasksSuccess, getTTasksError)

        }
        function getTTasksSuccess(data) {
            console.log(data)
            taskList = data;
            checkTTime();
            var cstrA = "";
            var cstrC = "";
            var years = {}
            for (a in taskList) {

                dateTimeArr = taskList[a].ForDate.split(" ");
                dateTimeArr[0] = dateTimeArr[0].split("/").reverse().join("-");
                if (isNaN(new Date(dateTimeArr[0] + "T00:00:00").getTime())) {
                    e = dateTimeArr[2];
                    x = [];
                    x = dateTimeArr[0].split("-");
                    x = x.map(k => k.length == 1 ? "0" + k : k);
                    y = dateTimeArr[1].split(":");
                    y[0] = e == "PM" && parseInt(y[0]) != 12 ? parseInt(y[0]) + 12 : y[0] == "12" && e == "AM" ? "00" : y[0];
                    y = y.map(k => k.length == 1 ? "0" + k : k);
                    taskList[a].ForDate = `${x[0]}-${x[2]}-${x[1]}T${y[0]}:${y[1]}:${y[2]}`;

                } else {
                    taskList[a].ForDate = dateTimeArr[0] + "T" + dateTimeArr[1];

                }

                dateTimeArr = taskList[a].OpenTill.split(" ");
                dateTimeArr[0] = dateTimeArr[0].split("/").reverse().join("-");
                if (isNaN(new Date(dateTimeArr[0] + "T00:00:00").getTime())) {
                    e = dateTimeArr[2];
                    x = [];
                    x = dateTimeArr[0].split("-");
                    x = x.map(k => k.length == 1 ? "0" + k : k);
                    y = dateTimeArr[1].split(":");
                    y[0] = e == "PM" && parseInt(y[0]) != 12 ? parseInt(y[0]) + 12 : y[0] == "12" && e == "AM" ? "00" : y[0];
                    y = y.map(k => k.length == 1 ? "0" + k : k);
                    taskList[a].OpenTill = `${x[0]}-${x[2]}-${x[1]}T${y[0]}:${y[1]}:${y[2]}`;

                } else {
                    taskList[a].OpenTill = dateTimeArr[0] + "T" + dateTimeArr[1];

                }



                yearOfStudy = (new Hebcal.HDate.prototype.getMonth() == 6 && new Date().getMonth == 8) ?
                    new Hebcal.HDate(new Date(new Date().getFullYear(), 8, 30)).toString('h').replace(' ה', ' ').split(" ")[2].replace('"', '``') :
                    new Hebcal.HDate().toString('h').replace(' ה', ' ').split(" ")[2].replace('"', '``');
                if (yearOfStudy == taskList[a].YearOfStudy) {
                    cstrA += createTaskDiv(taskList[a]);
                    sortedTaskList.push(taskList[a]);
                }
                years[yearOfStudy] = yearOfStudy;
                years[taskList[a].YearOfStudy] = taskList[a].YearOfStudy;

            }
            $("#tasks").html(cstrA);
            for (y in years) {
                $("#years>select").append(`<option value="${y.replace("``", "")}">${y}</optin>`);
            }

            $('#years>select>option[value=' + yearOfStudy.replace("``", "") + ']').attr('selected', true);
            connectTaskList();


        }

        function connectTaskList() {

            $(".cancel>ion-icon").hover(function () {

                sd = document.querySelectorAll(".cancel ion-icon")
                for (x in sd) {
                    sd[x].shadowRoot.querySelector(".icon-inner title").innerHTML = "ביטול שיוך"
                }

            });

            $(".fr").click(function () {

                ShowSubmitted(this.parentNode.id);
            });
            $(".tr .notification").click(function () {

                ShowSubmitted(this.parentNode.parentNode.id);
            });
            $(".sr span").click(function () {
                ShowSubmitted(this.parentNode.parentNode.parentNode.id);
            });
            $(".sr ion-icon").click(function () {
                $("#assigmentForm").slideToggle('2s');
                selectedTsakId = this.parentNode.parentNode.parentNode.id;
                t = getTakById(selectedTsakId);
                $("#classDate").val(t.ForDate);
                $("#submitionDate").val(t.OpenTill);
            });
            $(".cancel ion-icon").click(function () {
                val = this.parentNode.parentNode.parentNode.id;
                swal({
                    title: "אתה בטוח ??",
                    text: "שיוך המשימה והמשימות של תלמידים במשימה ימחקו",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true
                })
                    .then(function (willDelete) {
                        if (willDelete) removeTask(val);
                        else {
                            swal("Not Deleted!")

                        };
                    });
            });
        }


        function createTaskDiv(task) {


            const optionsForDate = { weekday: 'long', month: 'long', day: 'numeric' };
            const timeForDate = { hour: 'numeric', minute: 'numeric' };
            const optionsTillDate = { weekday: 'long', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' };
            var cstr = "";
            cstr += `<div class="col-sm-6 col-md-4 col-12" id="${task.taskId}">
                                         <div class="fr">
                                             <div class="name">
                                                <p>${task.Title}</p>
                                              </div>
                                            <div class="time">
                                               <p  title='${new Date(task.ForDate).toLocaleDateString(undefined, timeForDate)}'>${new Date(task.ForDate).toLocaleDateString(undefined, optionsForDate).replace("'", "")}'</p>
                                             </div>
                                         </div>

                                           <div class="sr">

                                            <div class="c_time">
                                               <img src="../images/calendar.png" /><span>${new Date(task.OpenTill).toLocaleDateString(undefined, optionsTillDate)}</span><ion-icon name="pencil-outline"></ion-icon>
                                                <span>`
            if (new Date(task.OpenTill) > new Date() && new Date(task.ForDate) < new Date())

                cstr += ` <ion-icon id="green" name="play"></ion-icon><span>(פתוח)</span>`

            else
                cstr += `<ion-icon id="red" name="play"></ion-icon><span>(סגור)</span>`

            cstr += `</span>`

            cstr += `</div>
                                                    </div>
                                                     <div class="tr">
                                                       <div class="notification">
                                                           <p>${task.numWaiting}</p >
                                                       </div>
                                                      <div class="cancel">
                                                         <ion-icon name="close-circle-outline" size="large"></ion-icon>
                                                      </div>
                                                  </div>


                                             </div>`

            return cstr;
        }

        function removeTask(taskId) {
            selectedTsakId = taskId;
            assignment = {

                TaskId: taskId,
                TeamId: activeTteam.Id,
                TeamSchoolCode: userOBJ.SCode,

            }

            ajaxCall("DELETE", "../api/Teacher/deleteAssigment", JSON.stringify(assignment), deleteAssigmentSuccess, deleteAssigmentError)
        }

        function deleteAssigmentSuccess(data) {
            console.log(data);
            for (x in taskList) {
                if (taskList[x].taskId == selectedTsakId) {
                    taskList.splice(x, 1);
                    break;
                }
            }

            $("#years>select").trigger('change');

        }
        function deleteAssigmentError(err) {
            console.log(err);
        }

        function getTakById(id) {
            for (x in taskList) {
                if (taskList[x].taskId == id) {
                    return taskList[x];
                }
            }
        }

        function getTTasksError(ex) {
            console.log(ex)

        }
        function addRemoveS() {
            localStorage["TeamMode"] = "edit";
            location.assign('addStudentToClass.html')
        }

        function addQuiz() {
            location.assign("Assignment_assignment.html")
        }

        function myFunction(x) {
            if (x.classList.contains("change")) {

            }
            x.classList.toggle("change");
            $("#teamList").toggle();

        }





        function ChartChange() {
            $("#statistics").height("400px")
            var x = document.getElementById("mySelect").value;
            var TaskCharts = document.getElementById("TaskCharts");
            var GradeCharts = document.getElementById("GradeCharts");
            var PercentageCharts = document.getElementById("PercentageCharts");
            var intlCharts = document.getElementById("intlCharts");
            if (x == "TaskCharts") {
                document.getElementById("info").style.display = "block"
                TaskCharts.style.display = "block";
                GradeCharts.style.display = "none";
                PercentageCharts.style.display = "none";
                intlCharts.style.display = "none";
            }
            else if (x == "GradeCharts") {
                document.getElementById("info").style.display = "block"
                TaskCharts.style.display = "none";
                GradeCharts.style.display = "block";
                PercentageCharts.style.display = "none";
                intlCharts.style.display = "none";
            }
            else if (x == "PercentageCharts") {
                document.getElementById("info").style.display = "block"
                TaskCharts.style.display = "none";
                GradeCharts.style.display = "none";
                PercentageCharts.style.display = "block";
                intlCharts.style.display = "none";
            }
            else if (x == "intlCharts") {
                document.getElementById("info").style.display = "block"
                TaskCharts.style.display = "none";
                GradeCharts.style.display = "none";
                PercentageCharts.style.display = "none";
                intlCharts.style.display = "block";
            }
            else {
                document.getElementById("info").style.display = "none"
                TaskCharts.style.display = "none";
                GradeCharts.style.display = "none";
                PercentageCharts.style.display = "none";
                intlCharts.style.display = "none";
            }

        }


    </script>
</head>
<body dir="rtl">
    <div id="assigment">
        <form id="assigmentForm">
            <a onclick="closeDivAU()"><span>Close x</span></a>
            <div id="class_date">
                <span>עבור תאריך:</span>
                <input type="datetime-local" step="1" id="classDate" />
            </div>
            <div id="submition_date">
                <span>תאריך הגשה אחרון:</span>
                <input type="datetime-local" step="1" id="submitionDate" />

            </div>
            <div id="assignmentFormBtn">
                <input type="submit" class="btn btn-info" value="שלח" />
            </div>

        </form>
  </div>

        <div id="ShowQuestionnaire">
            <a onclick="closeDivUS()"><span>Close x</span></a>
            <div id="TaskView">
                <div id="addContent">

                    <table id="sp_table" class="display nowrap" style="width:100%">
                        <thead>
                            <tr>

                                <th>מייל תלמיד</th>
                                <th>ממתין לבדיקה</th>
                                <th>ת.ז</th>
                                <th>שם מלא</th>
                                <th>שאלון</th>
                                <th>ציון</th>
                                <th>הערה</th>
                            </tr>
                        </thead>
                    </table>

                </div>
            </div>
        </div>

        <div id="container">
            <div id="header">
                <div class="row">

                    <div id="imgLogo" class="col-lg-3">

                        <img src="../images/EDvalueSmall.png" />

                    </div>

                    <div id="title" class="col-lg-6">
                        <h3>שם הקבוצה...</h3>

                    </div>

                    <div id="mindcetImg" class="col-lg-3 d-none d-lg-block">

                        <!--<img src="../images/MindCet.png" />-->

                    </div>

                </div>
                
                <nav class="navbar navbar-expand-lg navbar-light navBar">

                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse" id="navbarSupportedContent" style="flex-grow:0">
                        <ul class="navbar-nav navPadding">
                            <li class="nav-item">
                                <button class="btn btn-primary btnonSmall" onclick="addRemoveS()">ניהול קבוצה</button>
                            </li>
                            <li class="nav-item">
                                <button class="btn btn-primary btnonSmall" onclick="addQuiz()">הוסף מטלה</button>
                            </li>
                            <li class="nav-item">
                                <select class="btn btn-primary btnonSmall" id="teamSelect" onchange="openTeam()">
                                    <option team_Id="">הקבוצות שלי</option>
                                </select><!---->
                            </li>
                            <li class="nav-item">
                                <select class="btn btn-primary btnonSmall" id="nav_classes" onchange="openClass()">
                                    <option>הכיתות שלי</option>
                                </select>

                            </li>


                        </ul>

                    </div>
                    <select class="btn btn-primary btnonSmall" id="mySelect" onchange="ChartChange()">
                        <option value="" disabled selected hidden>בחר גרף</option>
                        <option value="TaskCharts">גרף הגשות</option>
                        <option value="GradeCharts">גרף ממוצעי ציונים</option>
                        <option value="PercentageCharts">אחוזי אינטלגנציות</option>
                        <option value="intlCharts">ניקוד אינטליגנציות</option>
                        <option value="CloseAll">לסגור הכל</option>
                    </select>
                    <div id="user_manage">
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        </button>
                        <div id="nav_cnt" class="dropdown-menu">
                            <p id="disconnect" onclick="disconnect()">התנתק</p>
                            <p id="cp" onclick="displayCP()">שנה סיסמא</p>
                        </div>
                    </div>
                </nav>


            </div>
               


  


            <div id="main">
                
                <div class="hide_list_teams change " onclick="myFunction(this)">
                    <div class="bar1"></div>
                    <div class="bar2"></div>
                    <div class="bar3"></div>
                </div>
                <div id="teamList">

                    <div id="slTitle">
                        <h4>תלמידים</h4>
                    </div>
                    <div id="sList">

                        <ul>
                        </ul>

                    </div>

                </div>

                <div id="info">
                    <div id="statistics">
                        <div id="stat_control_top">
                            <div class="capr">גלול אינטליגנציות</div>
                            <div id="IntelligenceCheckBox">
                            </div>
                            <div class="capl"></div>
                            
                        </div>

                        <div id="down">
                            <section>
                                <a href="#" class="scroll-down" address="true"></a>
                            </section>
                            
                        </div>
                        <div id="mainGraph">
                            <div class="content">
                                <div class="row" id="intlCharts" style="display:none">
                                    <h3 style="text-align:center">
                                        גרף זה לא מסונן
                                    </h3>
                                    <div class="wrapper col-12"><canvas id="intlChart"></canvas></div>

                                </div>
                                <div class="row" id="TaskCharts" style="display:none">

                                    <div class="wrapper col-12"><canvas id="TaskChart"></canvas></div>

                                </div>
                                <div class="row" id="GradeCharts" style="display:none">

                                    <div class="wrapper col-12"><canvas id="GradeChart"></canvas></div>

                                </div>
                                <div class="row" id="PercentageCharts" style="display:none">

                                    <div class="wrapper col-12"><canvas id="PercentageChart"></canvas></div>

                                </div>
                            </div>

                            <div id="stat_control_left">
                                <div id="toggleTask">גלול משימות</div>
                                <div id="taskName">

                                </div>

                            </div>
                        </div>



                    </div>


                </div>

                <div class="" id="class_info">
                    <div id="tasksTitle">
                        <div id="title">
                            <p>משימות ששוייכו</p>
                        </div>
                            <div id="years">
                                <select class="custom-select">
                                    
                                </select>
                            </div>
               
                    </div>

                    <div class="" id="tasks">


                    </div>

                </div>

            </div>
        </div>
</body>
</html>
